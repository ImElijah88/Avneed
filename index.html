<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avneed - Your Personal AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/pmrem/PMREMGenerator.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            color: #e2e8f0;
        }
        @layer base {
            :root {
                --color-neon-blue: #00FFFF;
            }
        }
        .text-neon-blue {
            color: var(--color-neon-blue);
        }
        .gradient-bg {
            background: linear-gradient(to right top, #0f172a, #1e293b, #334155);
        }
        .btn-primary, .ai-button {
            @apply px-10 py-4 rounded-full text-white font-bold text-lg shadow-lg transition duration-300 ease-in-out transform hover:scale-105;
            background: #2d3748;
            border: 2px solid #4a5568;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }
        .btn-primary:hover, .ai-button:hover {
            background: #374151;
            box-shadow: 0 0 25px 8px rgba(255, 215, 0, 0.7), 0 0 10px 2px rgba(255, 215, 0, 0.4);
            border-color: #ffd700;
        }
        .card {
            @apply bg-gray-800 p-8 rounded-[2.5rem] shadow-xl transition duration-300 ease-in-out hover:shadow-2xl hover:translate-y-[-5px];
            border: 1px solid rgba(74, 85, 104, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
        }
        .input-field {
            @apply p-4 rounded-2xl border border-gray-700 text-white focus:outline-none focus:ring-4 focus:ring-purple-600 transition duration-200 ease-in-out;
            background-color: #1a1a1a;
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid #ffd700;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .text-gray-800 { @apply text-gray-200; }
        .text-gray-900 { @apply text-gray-100; }
        .text-gray-700 { @apply text-gray-300; }
        .text-gray-500 { @apply text-gray-400; }
        .text-purple-700, .text-purple-800 { @apply text-yellow-400; }
        .file\:text-purple-700 { @apply file:text-yellow-400; }
        .file\:bg-purple-50 { @apply file:bg-gray-700; }
        .hover\:file\:bg-purple-100 { @apply hover:file:bg-gray-600; }

        /* General model container styling */
        .model-viewer-container {
            position: relative;
            width: 100%;
            height: 450px;
            background-color: transparent;
            border-radius: 2.5rem;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .model-viewer-canvas {
            display: block;
            width: 100%;
            height: 100%;
            border-radius: 2.5rem;
        }
        .model-status {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ffd700;
            font-size: 1.25rem;
            font-weight: 600;
            text-align: center;
            z-index: 10;
        }
        /* Styling for the new plus sign button */
        .model-file-input-label {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            width: 50px;
            height: 50px;
            background: #2d3748;
            border: 2px solid #4a5568;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            color: #e2e8f0;
            cursor: pointer;
            z-index: 15;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }
        .model-file-input-label:hover {
            background: #374151;
            color: var(--color-neon-blue);
            box-shadow: 0 0 25px 8px rgba(var(--color-neon-blue), 0.7), 0 0 10px 2px rgba(var(--color-neon-blue), 0.4);
            border-color: var(--color-neon-blue);
            transform: scale(1.1);
        }
        /* Robustly hide all actual file inputs */
        .hidden-file-input {
            display: none !important;
            width: 0;
            height: 0;
            overflow: hidden;
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        /* Styles for the resize handle */
        .resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            background-color: rgba(0, 255, 255, 0.5);
            border-radius: 0 0 2.5rem 0;
            cursor: nwse-resize;
            z-index: 20;
        }

        /* Specific adjustments for the contact section layout */
        .contact-content-wrapper {
            display: flex;
            flex-direction: column;
            gap: 2.5rem; /* Space between elements */
            align-items: center;
        }

        @media (min-width: 1024px) { /* On large screens, arrange side-by-side */
            .contact-content-wrapper {
                flex-direction: row;
                justify-content: center;
                align-items: flex-start; /* Align items to the top */
            }
            .contact-form-container {
                flex: 1; /* Allow form to take available space */
                max-width: 45%; /* Limit form width */
            }
            .new-model-viewer-area {
                flex: 1; /* Allow new viewer to take available space */
                max-width: 45%; /* Limit new viewer width */
            }
        }
    </style>
</head>
<body>
    <header class="gradient-bg text-white py-6 shadow-lg">
        <div class="container mx-auto flex justify-between items-center px-6">
            <h1 class="text-4xl font-extrabold tracking-tight text-neon-blue">Avneed</h1>
            <nav>
                <ul class="flex space-x-8 text-lg font-semibold">
                    <li><a href="#vision" class="hover:text-yellow-300 transition duration-300 transform hover:scale-105">Vision</a></li>
                    <li><a href="#capabilities" class="hover:text-yellow-300 transition duration-300 transform hover:scale-105">Capabilities</a></li>
                    <li><a href="#ai-demo" class="hover:text-yellow-300 transition duration-300 transform hover:scale-105">AI Demo</a></li>
                    <li><a href="#contact" class="hover:text-yellow-300 transition duration-300 transform hover:scale-105">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="gradient-bg text-white py-24 px-6 text-center overflow-hidden relative">
        <div class="container mx-auto relative z-10">
            <h2 class="text-6xl font-extrabold leading-tight mb-8 drop-shadow-lg">
                Empower Your Workflow with <span class="text-neon-blue">Avneed</span>
            </h2>
            <p class="text-2xl mb-12 max-w-4xl mx-auto opacity-90">
                The proactive, omnipresent AI assistant designed to seamlessly integrate with your digital life, providing intelligent support across all your devices.
            </p>
            <button class="btn-primary">Discover <span class="text-neon-blue">Avneed</span></button>
        </div>
        <div class="absolute inset-0 z-0 opacity-20">
            <div class="absolute top-1/4 left-1/4 w-48 h-48 bg-gray-700 rounded-full mix-blend-overlay animate-pulse-slow"></div>
            <div class="absolute bottom-1/3 right-1/4 w-64 h-64 bg-gray-700 rounded-full mix-blend-overlay animate-pulse-slow delay-1000"></div>
        </div>
    </section>

    <section id="vision" class="py-20 px-6 bg-[#1a1a2e] shadow-inner">
        <div class="container mx-auto text-center">
            <h3 class="text-5xl font-bold mb-16 text-gray-100 leading-tight">Our Vision: A Transformative Companion</h3>
            <div class="flex flex-col lg:flex-row items-center justify-center lg:space-x-16">
                <div class="lg:w-1/2 mb-12 lg:mb-0">
                    <div id="modelContainer" class="model-viewer-container">
                        <canvas id="modelCanvas" class="model-viewer-canvas"></canvas>
                        <div id="modelStatus" class="model-status hidden">
                            <div class="loading-spinner mb-4"></div>
                            <p>Loading 3D Model...</p>
                        </div>
                        <label for="modelFileInput" id="modelFileInputLabel" class="model-file-input-label">+</label>
                        <input type="file" id="modelFileInput" accept=".gltf, .glb" class="hidden-file-input">
                        <div id="resizeHandle" class="resize-handle"></div>
                    </div>
                </div>
                <div class="lg:w-1/2 text-left">
                    <p class="text-xl leading-relaxed mb-6 text-gray-300">
                        <span class="text-neon-blue">Avneed</span> is more than just a digital assistant; it's a meticulously engineered companion designed to seamlessly integrate with your unique working style and preferences. Our paramount objective is to furnish immediate, contextually relevant information and assistance for your personal projects, regardless of their complexity or scale.
                    </p>
                    <p class="text-xl leading-relaxed text-gray-300">
                        What truly sets <span class="text-neon-blue">Avneed</span> apart is its unique capability to operate autonomously even without internet connectivity. This ensures you're never left without the assistance you require, making it an invaluable ally for creative endeavors or critical research in remote locations.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <section id="capabilities" class="py-20 px-6 bg-[#121212]">
        <div class="container mx-auto text-center">
            <h3 class="text-5xl font-bold mb-16 text-gray-100 leading-tight">Unleash Your Potential with <span class="text-neon-blue">Avneed</span>'s Core Capabilities</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                <div class="card">
                    <h4 class="text-3xl font-bold mb-4 text-yellow-400">Persistent Desktop Presence</h4>
                    <p class="text-gray-300 leading-relaxed">
                        Imagine a floating, interactive 3D animated model that seamlessly integrates into your desktop, always visible and on top of other applications, transforming your workspace into a personalized hub.
                    </p>
                </div>
                <div class="card">
                    <h4 class="text-3xl font-bold mb-4 text-yellow-400">Dynamic Interaction</h4>
                    <p class="text-gray-300 leading-relaxed">
                        Engage with the 3D model to unveil a comprehensive interactive interface, complete with informative pop-ups and captivating animations that enrich your experience and foster deeper understanding.
                    </p>
                </div>
                <div class="card">
                    <h4 class="text-3xl font-bold mb-4 text-yellow-400">Multi-Modal Input</h4>
                    <p class="text-gray-300 leading-relaxed">
                        Interact effortlessly with <span class="text-neon-blue">Avneed</span> using conventional text-based inquiries, direct file uploads (Word, PDF, text), and intuitive voice commands via your device's microphone.
                    </p>
                </div>
                <div class="card">
                    <h4 class="text-3xl font-bold mb-4 text-yellow-400">Contextual Assistance</h4>
                    <p class="text-gray-300 leading-relaxed">
                        Harnesses your uploaded documents to cite specific details, condense content, extract essential concepts, and provide meticulous assistance with reports, books, or research endeavors.
                    </p>
                </div>
                <div class="card">
                    <h4 class="text-3xl font-bold mb-4 text-yellow-400">Cross-Device Functionality</h4>
                    <p class="text-gray-300 leading-relaxed">
                        Ingeniously engineered for seamless integration across laptops, desktops, and smartphones, ensuring you can access your work and <span class="text-neon-blue">Avneed</span>'s support whenever and wherever you choose.
                    </p>
                </div>
                <div class="card">
                    <h4 class="text-3xl font-bold mb-4 text-yellow-400">Offline Capability</h4>
                    <p class="text-gray-300 leading-relaxed">
                        The essential functionalities of <span class="text-neon-blue">Avneed</span> are meticulously designed to operate effectively without an active internet connection, particularly for processing local files, ensuring uninterrupted productivity.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <section id="ai-demo" class="py-20 px-6 bg-[#1a1a2e] shadow-inner">
        <div class="container mx-auto text-center">
            <h3 class="text-5xl font-bold mb-16 text-gray-100 leading-tight">Experience <span class="text-neon-blue">Avneed</span>'s AI Capabilities ✨</h3>
            <div class="max-w-4xl mx-auto bg-gray-900 p-10 rounded-3xl shadow-xl border border-gray-700">
                <p class="text-xl text-gray-300 mb-8">
                    Paste your text below or upload a file (.txt, .doc, .docx, .pdf) to see <span class="text-neon-blue">Avneed</span>'s intelligent assistance in action!
                    <br><span class="text-sm text-gray-400">(Note: Only plain text content will be processed from uploaded files.)</span>
                </p>
                <textarea id="aiInputText" class="w-full h-48 input-field mb-6 resize-y" placeholder="Paste your document text here..."></textarea>
                
                <label for="aiFileInput" id="aiFileInputLabel" class="mb-8 block w-fit mx-auto ai-button">Upload Document</label>
                <input type="file" id="aiFileInput" accept=".txt, .doc, .docx, .pdf" class="hidden-file-input">

                <div class="flex flex-wrap justify-center gap-4 mb-8">
                    <button id="summarizeBtn" class="ai-button">Summarize Document ✨</button>
                    <button id="keyConceptsBtn" class="ai-button">Extract Key Concepts ✨</button>
                    <button id="reportOutlineBtn" class="ai-button">Generate Report Outline ✨</button>
                </div>

                <div id="aiOutput" class="bg-[#1a1a1a] p-6 rounded-xl shadow-md text-left text-gray-200 min-h-[150px] overflow-auto border border-gray-700">
                    <p class="text-gray-400">Your AI-generated content will appear here.</p>
                </div>
                <div id="loadingIndicator" class="mt-4 text-center hidden">
                    <div class="loading-spinner"></div>
                    <p class="ml-2 text-gray-300 inline-block">Generating content...</p>
                </div>
                <div id="errorMessage" class="mt-4 text-center text-red-500 hidden">
                    <p>An error occurred. Please try again.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="contact" class="py-20 px-6 gradient-bg text-white text-center shadow-inner">
        <div class="container mx-auto">
            <h3 class="text-5xl font-bold mb-8 drop-shadow-lg">Ready to Transform Your Workflow?</h3>
            <p class="text-2xl mb-12 max-w-3xl mx-auto opacity-90">
                Join the future of personal AI assistance. Sign up for early access and stay tuned for <span class="text-neon-blue">Avneed</span>'s groundbreaking release!
            </p>
            <div class="contact-content-wrapper">
                <form class="contact-form-container max-w-lg mx-auto bg-gray-900 p-10 rounded-3xl shadow-2xl border border-gray-700">
                    <h4 class="text-3xl font-bold mb-8 text-gray-100">Get Early Access Updates</h4>
                    <div class="flex flex-col md:flex-row gap-6 mb-6">
                        <input type="text" placeholder="Your Name" class="flex-1 input-field">
                        <input type="email" placeholder="Your Email" class="flex-1 input-field">
                    </div>
                    <button type="submit" class="btn-primary w-full">Sign Up for Updates</button>
                </form>

                <!-- New 3D Model Viewer Container -->
                <div class="new-model-viewer-area max-w-lg mx-auto">
                    <div id="secondaryModelContainer" class="model-viewer-container">
                        <canvas id="secondaryModelCanvas" class="model-viewer-canvas"></canvas>
                        <div id="secondaryModelStatus" class="model-status hidden">
                            <div class="loading-spinner mb-4"></div>
                            <p>Loading 3D Model...</p>
                        </div>
                        <label for="secondaryModelFileInput" id="secondaryModelFileInputLabel" class="model-file-input-label">+</label>
                        <input type="file" id="secondaryModelFileInput" accept=".gltf, .glb" class="hidden-file-input">
                        <div id="secondaryResizeHandle" class="resize-handle"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-gray-950 text-white py-10 px-6">
        <div class="container mx-auto text-center text-gray-500">
            <p class="text-lg">&copy; 2025 <span class="text-neon-blue">Avneed</span>. All rights reserved.</p>
            <p class="mt-4 text-md">Designed with precision for an enhanced user experience and a smarter future.</p>
        </div>
    </footer>

    <script>
        const aiInputText = document.getElementById('aiInputText');
        const aiFileInput = document.getElementById('aiFileInput');
        const summarizeBtn = document.getElementById('summarizeBtn');
        const keyConceptsBtn = document.getElementById('keyConceptsBtn');
        const reportOutlineBtn = document.getElementById('reportOutlineBtn');
        const aiOutput = document.getElementById('aiOutput');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorMessage = document.getElementById('errorMessage');

        const modelContainer = document.getElementById('modelContainer');
        const modelCanvas = document.getElementById('modelCanvas');
        const modelFileInput = document.getElementById('modelFileInput');
        const modelStatus = document.getElementById('modelStatus');
        const resizeHandle = document.getElementById('resizeHandle');

        const aiFileInputLabel = document.getElementById('aiFileInputLabel');

        // New elements for the secondary model viewer
        const secondaryModelContainer = document.getElementById('secondaryModelContainer');
        const secondaryModelCanvas = document.getElementById('secondaryModelCanvas');
        const secondaryModelFileInput = document.getElementById('secondaryModelFileInput');
        const secondaryModelStatus = document.getElementById('secondaryModelStatus');
        const secondaryResizeHandle = document.getElementById('secondaryResizeHandle');

        aiFileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    aiInputText.value = e.target.result;
                };
                reader.onerror = () => {
                    aiOutput.innerHTML = '<p class="text-red-500">Error reading file.</p>';
                };
                reader.readAsText(file);
            }
        });

        async function callGeminiAPI(prompt) {
            loadingIndicator.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            aiOutput.innerHTML = '';

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });

            const payload = { contents: chatHistory };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    aiOutput.innerHTML = `<pre class="whitespace-pre-wrap">${text}</pre>`;
                } else {
                    aiOutput.innerHTML = '<p class="text-red-500">No content generated. Please try a different input or prompt.</p>';
                    console.error("Unexpected API response structure:", result);
                }
            } catch (error) {
                errorMessage.classList.remove('hidden');
                console.error("Error calling Gemini API:", error);
                aiOutput.innerHTML = '';
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        summarizeBtn.addEventListener('click', () => {
            const text = aiInputText.value.trim();
            if (text) {
                const prompt = `Summarize the following document concisely:\n\n${text}`;
                callGeminiAPI(prompt);
            } else {
                aiOutput.innerHTML = '<p class="text-red-500">Please provide text to summarize.</p>';
            }
        });

        keyConceptsBtn.addEventListener('click', () => {
            const text = aiInputText.value.trim();
            if (text) {
                const prompt = `Extract the key concepts and main ideas from the following document. Present them as a bulleted list:\n\n${text}`;
                callGeminiAPI(prompt);
            } else {
                aiOutput.innerHTML = '<p class="text-red-500">Please provide text to extract concepts from.</p>';
            }
        });

        reportOutlineBtn.addEventListener('click', () => {
            const text = aiInputText.value.trim();
            if (text) {
                const prompt = `Generate a detailed report outline based on the following document. Include sections, sub-sections, and key points relevant to the content:\n\n${text}`;
                callGeminiAPI(prompt);
            } else {
                aiOutput.innerHTML = '<p class="text-red-500">Please provide text to generate a report outline from.</p>';
            }
        });

        // --- 3D Viewer Logic (Generalized for multiple viewers) ---
        // Store instances of scenes, cameras, etc. in objects/maps if more viewers are added dynamically
        // For now, we'll keep separate variables for simplicity as there are only two.

        let scene1, camera1, renderer1, controls1, currentModel1, mixer1;
        const clock1 = new THREE.Clock();

        let scene2, camera2, renderer2, controls2, currentModel2, mixer2;
        const clock2 = new THREE.Clock();

        function init3DViewer(canvas, container, statusElement) {
            const scene = new THREE.Scene();
            scene.background = null;

            const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 0, 5);

            const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);

            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.25;
            controls.screenSpacePanning = false;
            controls.maxPolarAngle = Math.PI / 2;

            const ambientLight = new THREE.AmbientLight(0xffffff, 2.5);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.8);
            directionalLight.position.set(0, 5, 5).normalize();
            scene.add(directionalLight);

            const pointLight = new THREE.PointLight(0x00FFFF, 2.0, 100);
            pointLight.position.set(2, 2, 2);
            scene.add(pointLight);

            statusElement.classList.remove('hidden');
            statusElement.innerHTML = '<p>Upload a 3D model (.gltf, .glb)</p><p>Use mouse to interact</p>';

            // Return the Three.js components for later use
            return { scene, camera, renderer, controls, currentModel: null, mixer: null };
        }

        function onWindowResize(camera, renderer, container) {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        function animate3D(viewerInstance, clock) {
            requestAnimationFrame(() => animate3D(viewerInstance, clock));

            const delta = clock.getDelta();

            if (viewerInstance.mixer) {
                viewerInstance.mixer.update(delta);
            }

            if (viewerInstance.currentModel) {
                viewerInstance.currentModel.rotation.y += 0.015;
            }

            viewerInstance.controls.update();
            viewerInstance.renderer.render(viewerInstance.scene, viewerInstance.camera);
        }

        function setupModelFileInput(fileInput, statusElement, viewerInstance) {
            fileInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const fileName = file.name.toLowerCase();
                if (!fileName.endsWith('.gltf') && !fileName.endsWith('.glb')) {
                    statusElement.classList.remove('hidden');
                    statusElement.innerHTML = '<p class="text-red-500">Unsupported file type. Please upload .gltf or .glb.</p>';
                    return;
                }

                statusElement.classList.remove('hidden');
                statusElement.innerHTML = '<div class="loading-spinner mb-4"></div><p>Loading 3D Model...</p>';
                fileInput.style.display = 'none';
                fileInput.previousElementSibling.style.display = 'none'; // Hide the plus sign label

                const reader = new FileReader();
                reader.onload = (e) => {
                    const loader = new THREE.GLTFLoader();
                    loader.parse(e.target.result, '', (gltf) => {
                        if (viewerInstance.currentModel) {
                            viewerInstance.scene.remove(viewerInstance.currentModel);
                            if (viewerInstance.mixer) {
                                viewerInstance.mixer.stopAllAction();
                                viewerInstance.mixer = null;
                            }
                        }
                        viewerInstance.currentModel = gltf.scene;
                        viewerInstance.scene.add(viewerInstance.currentModel);

                        if (gltf.scene.environment) {
                            viewerInstance.scene.environment = gltf.scene.environment;
                        }

                        if (gltf.animations && gltf.animations.length) {
                            viewerInstance.mixer = new THREE.AnimationMixer(viewerInstance.currentModel);
                            gltf.animations.forEach((clip) => {
                                viewerInstance.mixer.clipAction(clip).play();
                            });
                            console.log("Animations found and playing:", gltf.animations.length);
                        } else {
                            console.log("No animations found in this model.");
                        }

                        const box = new THREE.Box3().setFromObject(viewerInstance.currentModel);
                        const center = box.getCenter(new THREE.Vector3());
                        const size = box.getSize(new THREE.Vector3());
                        const maxDim = Math.max(size.x, size.y, size.z);
                        const fov = viewerInstance.camera.fov * (Math.PI / 180);
                        let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));
                        cameraZ *= 1.5;

                        viewerInstance.camera.position.set(center.x, center.y, center.z + cameraZ);
                        viewerInstance.controls.target.set(center.x, center.y, center.z);
                        viewerInstance.controls.update();

                        statusElement.classList.add('hidden');
                        fileInput.style.display = 'block';
                        fileInput.previousElementSibling.style.display = 'flex'; // Show the plus sign label

                    }, (xhr) => {
                        const percent = (xhr.loaded / xhr.total * 100).toFixed(0);
                        statusElement.innerHTML = `<div class="loading-spinner mb-4"></div><p>Loading: ${percent}%</p>`;
                    }, (error) => {
                        statusElement.classList.remove('hidden');
                        statusElement.innerHTML = `<p class="text-red-500">Error loading model: ${error.message || 'Unknown error'}</p>`;
                        console.error('Error loading GLTF model:', error);
                        fileInput.style.display = 'block';
                        fileInput.previousElementSibling.style.display = 'flex'; // Show the plus sign label
                    });
                };
                reader.onerror = () => {
                    statusElement.classList.remove('hidden');
                    statusElement.innerHTML = '<p class="text-red-500">Error reading file.</p>';
                    fileInput.style.display = 'block';
                    fileInput.previousElementSibling.style.display = 'flex'; // Show the plus sign label
                };
                reader.readAsArrayBuffer(file);
            });
        }

        function setupResizeHandle(handle, container, camera, renderer) {
            let isResizing = false;
            let initialX, initialY, initialWidth, initialHeight;

            handle.addEventListener('mousedown', (e) => {
                isResizing = true;
                initialX = e.clientX;
                initialY = e.clientY;
                initialWidth = container.offsetWidth;
                initialHeight = container.offsetHeight;

                document.body.style.userSelect = 'none';
                document.body.style.cursor = 'nwse-resize';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;

                const minWidth = 300;
                const minHeight = 200;
                const maxWidth = window.innerWidth * 0.9;
                const maxHeight = window.innerHeight * 0.8;

                let newWidth = initialWidth + (e.clientX - initialX);
                let newHeight = initialHeight + (e.clientY - initialY);

                newWidth = Math.max(minWidth, Math.min(newWidth, maxWidth));
                newHeight = Math.max(minHeight, Math.min(newHeight, maxHeight));

                container.style.width = `${newWidth}px`;
                container.style.height = `${newHeight}px`;

                onWindowResize(camera, renderer, container);
            });

            document.addEventListener('mouseup', () => {
                isResizing = false;
                document.body.style.userSelect = '';
                document.body.style.cursor = '';
            });
        }


        window.onload = function() {
            // Initialize the first 3D viewer
            const viewer1 = init3DViewer(modelCanvas, modelContainer, modelStatus);
            scene1 = viewer1.scene;
            camera1 = viewer1.camera;
            renderer1 = viewer1.renderer;
            controls1 = viewer1.controls;
            currentModel1 = viewer1.currentModel;
            mixer1 = viewer1.mixer;
            setupModelFileInput(modelFileInput, modelStatus, viewer1);
            setupResizeHandle(resizeHandle, modelContainer, camera1, renderer1);
            animate3D(viewer1, clock1);

            // Initialize the secondary 3D viewer
            const viewer2 = init3DViewer(secondaryModelCanvas, secondaryModelContainer, secondaryModelStatus);
            scene2 = viewer2.scene;
            camera2 = viewer2.camera;
            renderer2 = viewer2.renderer;
            controls2 = viewer2.controls;
            currentModel2 = viewer2.currentModel;
            mixer2 = viewer2.mixer;
            setupModelFileInput(secondaryModelFileInput, secondaryModelStatus, viewer2);
            setupResizeHandle(secondaryResizeHandle, secondaryModelContainer, camera2, renderer2);
            animate3D(viewer2, clock2);
        };
    </script>
</body>
</html>
